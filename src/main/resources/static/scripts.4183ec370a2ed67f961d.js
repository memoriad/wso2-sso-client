var hwcrypto=function(){"use strict";function e(e){return navigator.mimeTypes&&e in navigator.mimeTypes}function n(e){return"function"==typeof window[e]}function t(e){if("string"==typeof e){for(var n=Math.floor(e.length/2),t=new Uint8Array(n),r=0;r<n;r++)t[r]=parseInt(e.substr(2*r,2),16);return t}}function r(){var t="probe() detected ";n(l)&&s(t+l),e(f)&&s(t+f)}function i(){function e(e){return new Error(function(e){switch(s("Error: "+e+" with: "+n.errorMessage),parseInt(e)){case 1:return h;case 2:return d;case 15:return w;case 17:return g;case 19:return p;default:return s("Unknown error: "+e+" with: "+n.errorMessage),m}}(e))}this._name="NPAPI/BHO for application/x-digidoc";var n=function(e){var n=function(e){return"hwc"+e.replace("/","").replace("-","")}(e);if(document.getElementById(n))return s("Plugin element already loaded"),document.getElementById(n);s("Loading plugin for "+e+" into "+n);var t='<object id="'+n+'" type="'+e+'" style="width: 1px; height: 1px; position: absolute; visibility: hidden;"></object>',r=document.createElement("div");return r.setAttribute("id","pluginLocation"+n),document.body.appendChild(r),document.getElementById("pluginLocation"+n).innerHTML=t,document.getElementById(n)}(f),t={};this.check=function(){return new Promise(function(e,t){setTimeout(function(){e(void 0!==n.version)},0)})},this.getVersion=function(){return new Promise(function(e,t){e(n.version)})},this.getCertificate=function(r){return r&&r.lang&&(n.pluginLanguage=r.lang),new Promise(function(i,o){try{var a=n.version.split("."),c=a[0]>=3&&a[1]>=13?n.getCertificate(r.filter):n.getCertificate();0!==parseInt(n.errorCode)?o(e(n.errorCode)):(t[c.cert]=c.id,i({hex:c.cert}))}catch(r){s(r),o(e(n.errorCode))}})},this.sign=function(r,i,o){return new Promise(function(a,c){var u=t[r.hex];if(u)try{var f=o.lang||"en",l=o.info||"",h=n.version.split(".");a({hex:h[0]>=3&&h[1]>=13?n.sign(u,i.hex,f,l):n.sign(u,i.hex,f)})}catch(r){s(JSON.stringify(r)),c(e(n.errorCode))}else s("invalid certificate: "+r),c(new Error(g))})}}function o(){this._name="Chrome native messaging extension";var e=null;this.check=function(){return new Promise(function(t,r){if(!n(l))return t(!1);t(!!(e=new window[l]))})},this.getVersion=function(){return e.getVersion()},this.getCertificate=function(n){return e.getCertificate(n)},this.sign=function(n,t,r){return e.sign(n,t,r)}}function a(){this._name="No implementation",this.check=function(){return new Promise(function(e,n){e(!0)})},this.getVersion=function(){return Promise.reject(new Error(v))},this.getCertificate=function(){return Promise.reject(new Error(v))},this.sign=function(){return Promise.reject(new Error(v))}}function c(e){return new Promise(function(n,t){var r=new e;r.check().then(function(e){e?(s("Using backend: "+r._name),E=r,n(!0)):(s(r._name+" check() failed"),n(!1))})})}function u(t){return new Promise(function(r,u){function h(){c(i).then(function(e){r(!!e||c(a))})}return s("Autodetecting best backend"),void 0===t&&(t=!1),null===E||t?-1!=navigator.userAgent.indexOf("MSIE")||-1!=navigator.userAgent.indexOf("Trident")?(s("Assuming IE BHO, testing"),h()):n(l)?void c(o).then(function(e){e?r(!0):h()}):e(f)?h():void r(c(a)):r(!0)})}var s=function(e){};s("hwcrypto.js activated"),window.addEventListener=window.addEventListener||window.attachEvent;var f="application/x-digidoc",l="TokenSigning",h="user_cancel",d="no_certificates",g="invalid_argument",w="driver_error",m="technical_error",v="no_implementation",p="not_allowed";window.addEventListener("load",function(e){r()});var E=null,C={use:function(e){return new Promise(function(n,t){void 0===e||"auto"===e?u().then(function(e){n(e)}):n("chrome"===e?c(o):"npapi"===e&&c(i))})},debug:function(){return new Promise(function(e,n){u().then(function(n){E.getVersion().then(function(n){e("hwcrypto.js 0.0.13 with "+E._name+" "+n)},function(n){e("hwcrypto.js 0.0.13 with failing backend "+E._name)})})})},getCertificate:function(e){return"object"!=typeof e?(s("getCertificate options parameter must be an object"),Promise.reject(new Error(g))):(e&&!e.lang&&(e.lang="en"),u().then(function(n){return"https:"!==location.protocol&&"file:"!==location.protocol?Promise.reject(new Error(p)):E.getCertificate(e).then(function(e){return e.hex&&!e.encoded&&(e.encoded=t(e.hex)),e})}))},sign:function(e,n,r){return arguments.length<2?Promise.reject(new Error(g)):(r&&!r.lang&&(r.lang="en"),n.type&&(n.value||n.hex)?(n.hex&&!n.value&&(s("DEPRECATED: hash.hex as argument to sign() is deprecated, use hash.value instead"),n.value=t(n.hex)),n.value&&!n.hex&&(n.hex=function(e){for(var n="",t=0;t<e.length;t++)n+=(e[t]<16?"0":"")+e[t].toString(16);return n.toLowerCase()}(n.value)),u().then(function(i){return"https:"!==location.protocol&&"file:"!==location.protocol?Promise.reject(new Error(p)):E.sign(e,n,r).then(function(e){return e.hex&&!e.value&&(e.value=t(e.hex)),e})})):Promise.reject(new Error(g)))}};return C.NO_IMPLEMENTATION=v,C.USER_CANCEL=h,C.NOT_ALLOWED=p,C.NO_CERTIFICATES=d,C.TECHNICAL_ERROR=m,C.INVALID_ARGUMENT=g,C}();if(!window.atob){var tableStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",table=tableStr.split("");window.atob=function(e){if(/(=[^=]+|={3,})$/.test(e))throw new Error("String contains an invalid character");var n=3&(e=e.replace(/=/g,"")).length;if(1===n)throw new Error("String contains an invalid character");for(var t=0,r=0,i=e.length/4,o=[];t<i;++t){var a=tableStr.indexOf(e[r++]||"A"),c=tableStr.indexOf(e[r++]||"A"),u=tableStr.indexOf(e[r++]||"A"),s=tableStr.indexOf(e[r++]||"A");if((a|c|u|s)<0)throw new Error("String contains an invalid character");o[o.length]=255&(a<<2|c>>4),o[o.length]=255&(c<<4|u>>2),o[o.length]=255&(u<<6|s)}return String.fromCharCode.apply(null,o).substr(0,o.length+n-4)},window.btoa=function(e){for(var n=0,t=0,r=e.length/3,i=[];n<r;++n){var o=e.charCodeAt(t++),a=e.charCodeAt(t++),c=e.charCodeAt(t++);if((o|a|c)>255)throw new Error("String contains an invalid character");i[i.length]=table[o>>2]+table[o<<4&63|a>>4]+(isNaN(a)?"=":table[a<<2&63|c>>6])+(isNaN(a+c)?"=":table[63&c])}return i.join("")}}function hexToBase64(e){return btoa(String.fromCharCode.apply(null,e.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")))}function hexToPem(e){return"-----BEGIN CERTIFICATE-----\n"+hexToBase64(e).match(/.{1,64}/g).join("\n")+"\n-----END CERTIFICATE-----"}